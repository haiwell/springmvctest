/*
 * Editable 1.3.3
 *
 * Copyright (c) 2009 Arash Karimzadeh (arashkarimzadeh.com)
 * Licensed under the MIT (MIT-LICENSE.txt)
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Mar 02 2009
 */
(function(a){a.fn.editable=function(b){var c={onEdit:null,onSubmit:null,onCancel:null,editClass:null,submit:null,cancel:null,type:"text",submitBy:"dblclick",editBy:"click",options:null};if(b=="disable"){return this.unbind(this.data("editable.options").editBy,this.data("editable.options").toEditable)}if(b=="enable"){return this.bind(this.data("editable.options").editBy,this.data("editable.options").toEditable)}if(b=="destroy"){return this.unbind(this.data("editable.options").editBy,this.data("editable.options").toEditable).data("editable.previous",null).data("editable.current",null).data("editable.options",null)}var b=a.extend(c,b);b.toEditable=function(){$this=a(this);$this.data("editable.current",$this.html());opts=$this.data("editable.options");if(opts.current){opts.toNonEditable(opts.current,true);opts.current=null}var d=a.editableFactory[opts.type].toEditable($this.empty(),opts);opts.current=$this;d.keydown(function(f){if(f.keyCode==27){f.preventDefault();opts.toNonEditable($this,false)}else{if(f.keyCode==13&&(opts.type=="text"||opts.type=="password")){f.preventDefault();opts.toNonEditable($this,true)}}});if(!opts.editClass){d.css("width","100%")}$this.data("editable.previous",$this.data("editable.current")).children().focus().addClass(opts.editClass);if(opts.submit){a("<button/>").appendTo($this).html(opts.submit).one("mouseup",function(){opts.toNonEditable(a(this).parent(),true)})}else{$this.one(opts.submitBy,function(){opts.toNonEditable(a(this),true)}).children().one(opts.submitBy,function(){opts.toNonEditable(a(this).parent(),true)})}if(opts.cancel){a("<button/>").appendTo($this).html(opts.cancel).one("mouseup",function(){opts.toNonEditable(a(this).parent(),false)})}if(a.isFunction(opts.onEdit)){opts.onEdit.apply($this,[{current:$this.data("editable.current"),previous:$this.data("editable.previous")},d,$this])}};b.toNonEditable=function(e,f){opts=e.data("editable.options");e.one(opts.editBy,opts.toEditable).data("editable.current",f?a.editableFactory[opts.type].getValue(e,opts):e.data("editable.current")).html(opts.type=="password"?"*****":e.data("editable.current"));var d=null;if(a.isFunction(opts.onSubmit)&&f==true){d=opts.onSubmit}else{if(a.isFunction(opts.onCancel)&&f==false){d=opts.onCancel}}if(d!=null){d.apply(e,[{current:e.data("editable.current"),previous:e.data("editable.previous")},e])}opts.current=null};this.data("editable.options",b);return this.one(b.editBy,b.toEditable)};a.editableFactory={text:{toEditable:function(c,b){return a("<input/>").appendTo(c).val(c.data("editable.current"))},getValue:function(c,b){return c.children().val()}},password:{toEditable:function(c,b){c.data("editable.current",c.data("editable.password"));c.data("editable.previous",c.data("editable.password"));return a('<input type="password"/>').appendTo(c).val(c.data("editable.current"))},getValue:function(c,b){c.data("editable.password",c.children().val());return c.children().val()}},textarea:{toEditable:function(c,b){return a("<textarea/>").appendTo(c).val(c.data("editable.current"))},getValue:function(c,b){return c.children().val()}},select:{toEditable:function(c,b){$select=a("<select/>").appendTo(c);a.each(b.options,function(d,e){a("<option/>").appendTo($select).html(e).attr("value",d)});$select.children().each(function(){var d=a(this);if(d.text()==c.data("editable.current")){return d.attr("selected","selected").text()}});return $select},getValue:function(d,b){var c=null;a("select",d).children().each(function(){if(a(this).attr("selected")){return c=a(this).text()}});return c}}}})(jQuery);